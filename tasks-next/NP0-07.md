# ID: NP0-07

## Title

Offline‑Guaranteed contract and SW shell generator

## Status

DONE

## Context

Service worker exists and offline fallback works, but Offline‑Guaranteed tier should be enforced by contract (what routes/assets must work offline after first use). Current `SHELL_ASSETS` is hand-maintained.

## Steps

1. Define an Offline‑Guaranteed contract list:
   - core routes (home, hubs, offline page)
   - top tool routes
   - required assets (fonts, workers, icons)
2. Generate `SHELL_ASSETS` at build time from the registry (no runtime dependency).
3. Add CI contract tests validating:
   - generated list includes required routes
   - list stays within a size budget
4. Expand e2e offline tests to cover deep tool routes reliably.

## Acceptance Criteria

- Offline‑Guaranteed routes load offline after an initial warmup session.
- SW cache versioning remains enforced.

## Dependencies

- None.

## Files to modify

- `public/sw.js`
- `lib/tools-registry.ts`
- `scripts/pwa/*` (generator)
- `tests/e2e/offline.spec.ts`

## Implementation Notes

- Added generated shell-assets pipeline from tool registry: `scripts/pwa/generate-shell-assets.ts`.
- Added deterministic generated artifact: `data/pwa/shell-assets.generated.json`.
- `public/sw.js` now consumes marker-based generated shell asset block.
- Added contract tests for required routes + size budget + generated sync.
- Expanded offline E2E with deep route warmup check (`/pdf-tools/merge/merge-pdf`).

## Verification

- `pnpm pwa:shell:generate`
- `pnpm pwa:shell:check`
- `pnpm vitest --run tests/unit/pwa-shell-assets-contract.test.ts`
